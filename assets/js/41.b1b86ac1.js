(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{580:function(t,e,_){"use strict";_.r(e);var a=_(4),s=Object(a.a)({},(function(){var t=this,e=t.$createElement,_=t._self._c||e;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("p",[t._v("分页查询对应前端交互来说有翻页和瀑布流两种形式，但是如果在分页过程中，后台列表数据进行了新增或者删除等操作，查看下一页时，查询到的数据就可能有误。")]),t._v(" "),_("hr"),t._v(" "),_("h2",{attrs:{id:"问题"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[t._v("#")]),t._v(" 问题")]),t._v(" "),_("p",[t._v("一般接口分页时，主要通过"),_("code",[t._v("page")]),t._v("和"),_("code",[t._v("size")]),t._v("两个参数来请求后台，对后台来说只会按照传参查询，对于数据列表增删变更并未做处理。")]),t._v(" "),_("p",[t._v("以瀑布流为例，下拉加载的时候，如果数据列表新增了一条数据，再请求会多出一条重复数据，\n如果数据列表删除了一条数据，有一条数据在下次请求时就不会返回，页面上就会出现数据丢失的情况。")]),t._v(" "),_("h2",{attrs:{id:"目前解决方案"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#目前解决方案"}},[t._v("#")]),t._v(" 目前解决方案")]),t._v(" "),_("div",{staticClass:"custom-block tip"},[_("p",{staticClass:"title"}),_("p",[t._v("只需要将当前最后一条数据的"),_("code",[t._v("排序因素")]),t._v("和"),_("code",[t._v("size")]),t._v("参数返回给后台，后台在指定排序后根据前端返回的排序因素往后取数据。")])]),_("p",[t._v("假设当前列表数据直接按 ID 降序排序，每次前端请求时，将当前最后一条数据的 ID 作为参数"),_("code",[t._v("lastId")]),t._v("传递给后台（如果是第一页传 0），后台取数据时，查询使用\n"),_("code",[t._v("其他条件 and id < #{lastId} order by id desc limit #{size}")]),t._v("；")]),t._v(" "),_("p",[t._v("如果按 ID 升序排序，则是"),_("code",[t._v("其他条件 and id > #{lastId} limit #{size}")])]),t._v(" "),_("p",[t._v("如果是按更新时间降序排序，则传递最后一条数据的更新时间"),_("code",[t._v("lastUpdateTime")]),t._v("，后台查询使用\n"),_("code",[t._v("其他条件 and update_time < #{lastUpdateTime} order by update_time desc limit #{size}")]),t._v("。")]),t._v(" "),_("p",[_("br"),_("br"),_("br")]),t._v(" "),_("hr"),t._v(" "),_("p",[_("strong",[t._v("参考链接：")])]),t._v(" "),_("ul",[_("li",[_("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/42366779",target:"_blank",rel:"noopener noreferrer"}},[t._v("搞清楚分页了吗 - 知乎"),_("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=s.exports}}]);
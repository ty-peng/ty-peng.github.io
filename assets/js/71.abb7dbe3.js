(window.webpackJsonp=window.webpackJsonp||[]).push([[71],{611:function(t,s,a){"use strict";a.r(s);var n=a(4),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("经过不懈努力，终于完成了使用"),a("code",[t._v("GitHub Actions")]),t._v("对"),a("code",[t._v("VuePress")]),t._v("博客在\nGitHub Pages 和 Gitee Pages 的自动部署。\n其他的页面生成器静态资源自动部署同理，其实"),a("code",[t._v("GitHub Actions")]),t._v("还有很多玩法，\n只是目前我对其也只是了解了大概，以后有时间再多研究研究。")]),t._v(" "),a("h2",{attrs:{id:"个人对于-github-actions-的理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#个人对于-github-actions-的理解"}},[t._v("#")]),t._v(" 个人对于 GitHub Actions 的理解")]),t._v(" "),a("p",[t._v("GitHub Actions 其实就是 GitHub 用来做持续集成 CI 的一个东西，\n原理上就是当你触发了 workflow 文件设置的触发条件（如：push 等），\n就会分配一个虚拟主机（配置也不低）给你执行你 workflow 里写好的操作，\n可以使用 docker 相关的，也可以是运行命令行，也可以是 js 等，\nGitHub 还是相当大方的，对于个人使用来说完全足够。")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/features/actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("Features • GitHub Actions"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"设置-secrets"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置-secrets"}},[t._v("#")]),t._v(" 设置 Secrets")]),t._v(" "),a("p",[t._v("首先进入 GitHub 仓库页面，在项目的"),a("code",[t._v("Setting > Secrets")]),t._v("设置里添加一些秘钥 token 等信息；")]),t._v(" "),a("blockquote",[a("p",[t._v("官方说明："),a("br"),t._v("\nSecrets 是加密的环境变量，仅对选定的操作公开。"),a("br"),t._v("\n具有对此存储库协作者访问权限的任何人都可以在工作流中使用这些 Secrets。"),a("br"),t._v("\nSecrets 不会传递给由 fork 的拉取请求触发的工作流。")])]),t._v(" "),a("p",[t._v("如下图，点击"),a("code",[t._v("Add a new secret")]),t._v(" "),a("img",{attrs:{src:"/img/other/20200323230011.jpg",alt:""}})]),t._v(" "),a("p",[t._v("视自己需求，如果只需要部署到 GitHub Pages，生成 GitHub 的 Personal Access Token 添加到此处即可；\n如果还需要部署到 Gitee， 还要添加一个 Gitee 的 Personal Access Token。")]),t._v(" "),a("p",[t._v("我这里两个都添加了，Personal Access Token 的生成教程见"),a("a",{attrs:{href:"https://help.github.com/cn/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line",target:"_blank",rel:"noopener noreferrer"}},[t._v("创建用于命令行的个人访问令牌"),a("OutboundLink")],1),t._v(" "),a("img",{attrs:{src:"/img/other/20200323234051.jpg",alt:""}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"title"}),a("p",[t._v("授予权限的时候只给 repo 权限即可。")])]),a("h2",{attrs:{id:"创建-github-actions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-github-actions"}},[t._v("#")]),t._v(" 创建 GitHub Actions")]),t._v(" "),a("p",[t._v("在 GitHub 仓库页面选择"),a("code",[t._v("Actions")]),t._v("，如下图\n"),a("img",{attrs:{src:"/img/other/20200323234753.jpg",alt:""}})]),t._v(" "),a("p",[t._v("页面下方有一些现成的 GitHub Actions，如果恰好符合的你的需求可以直接点进去详情以了解如何使用。")]),t._v(" "),a("p",[t._v("这里我选择自己创建一个 workflow 文件，文件内容如下：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("./.github/workflows/main.yml")])])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CI\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 触发条件：在 push 到 master 分支后")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("branches")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" master\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 环境变量，如之前设置的 BLOG_ACCESS_TOKEN 和 GITEE_BLOG_ACCESS_TOKEN 在这里以以下方式被引用")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GITHUB_TOKEN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.BLOG_ACCESS_TOKEN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GITEE_TOKEN")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" secrets.GITEE_BLOG_ACCESS_TOKEN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GIT_USER_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 输入你想设置的 Git 用户名\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GIT_USER_EMAIL")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 输入你的邮箱\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GITHUB_USER_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" GitHub的账号名\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GITEE_USER_NAME")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 这个是要部署到 Gitee 时用的 Gitee 的账号用户名\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 任务")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("jobs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("Deploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 服务器环境：最新版 Ubuntu")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runs-on")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ubuntu"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("latest\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("steps")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拉取代码")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Checkout 🛎️\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uses")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" actions/checkout@v2\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("with")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persist-credentials")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Number of commits to fetch. 0 indicates all history.")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fetch-depth")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 生成静态文件")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Install and Build 🔧\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n          rm -rf public\n          yarn install\n          yarn build")]),t._v("\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 初始化编译后的目录，最后一条命令git remote add gitee是用于推送Gitee的，不需要可以删除")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Init Dist ⌛\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v("\n          git init\n          git config user.email $GIT_USER_EMAIL\n          git config user.name $GIT_USER_NAME\n          git add -A\n          git commit --allow-empty -m 'deploy'\n          git remote add origin https://$GITHUB_TOKEN@github.com/$GITHUB_USER_NAME/my-blog.git\n          git remote add github https://$GITHUB_TOKEN@github.com/$GITHUB_USER_NAME/$GITHUB_USER_NAME.github.io.git\n          git remote add gitee  https://$GITEE_USER_NAME:$GITEE_TOKEN@gitee.com/$GITEE_USER_NAME/$GITEE_USER_NAME.git")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("working-directory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./public\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 部署到仓库的 Pages")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy to Repository Pages 🎨\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" git push "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f origin master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("gh"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pages\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("working-directory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./public\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 部署到 GitHub Pages")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy to GitHub Pages 🎐\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" git push "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("f github master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("master\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("working-directory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./public\n\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 部署到 Gitee Pages，不需要可以删除")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deploy to Gitee Pages 🎉\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n          git push -f gitee master:master\n          sleep 5s\n          echo ">>>Start Update Gitee Pages>>>"\n          curl -X POST --header \'Content-Type: application/json;charset=UTF-8\' "https://gitee.com/api/v5/repos/$GITEE_USER_NAME/$GITEE_USER_NAME/pages/builds" -d \'{"access_token":"\'"$GITEE_TOKEN"\'"}\'\n          echo ""\n          echo "<<<End Update Gitee Pages<<<"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("working-directory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./public\n")])])]),a("p",[t._v("附上 workflow 详细语法：\n"),a("a",{attrs:{href:"https://help.github.com/cn/actions/reference/workflow-syntax-for-github-actions#",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub 操作的工作流程语法"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("上面都是我直接写的命令用来部署，如果你只需要部署到 GitHub Pages，可以参考文末的链接，\n使用了现成的 GitHub Actions，写起来简单一点。")]),t._v(" "),a("p",[t._v("GitHub Actions 市场：\n"),a("a",{attrs:{href:"https://github.com/marketplace?type=actions",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Marketplace · Actions"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("还有几个我觉得可能有用的 GitHub Actions：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/marketplace/actions/github-pages",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Pages"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/marketplace/actions/deploy-to-github-pages",target:"_blank",rel:"noopener noreferrer"}},[t._v("Deploy to GitHub Pages"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/marketplace/actions/github-push",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub Push"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("strong",[t._v("参考链接")])]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://vuepress-theme-reco.recoluan.com/views/other/github-actions.html#%E8%AE%BE%E7%BD%AE-secrets",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用 GitHub Actions 自动部署博客"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);
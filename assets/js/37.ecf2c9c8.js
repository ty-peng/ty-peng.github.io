(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{576:function(e,t,s){"use strict";s.r(t);var a=s(4),r=Object(a.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h2",{attrs:{id:"zookeeper-简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper-简介"}},[e._v("#")]),e._v(" Zookeeper 简介")]),e._v(" "),s("ul",[s("li",[e._v("官方 Overview\n"),s("blockquote",[s("p",[s("strong",[e._v("ZooKeeper: A Distributed Coordination Service for Distributed Applications")]),s("br"),e._v("\nZooKeeper is a distributed, open-source coordination service for distributed applications. It exposes a simple set of primitives that distributed applications can build upon to implement higher level services for synchronization, configuration maintenance, and groups and naming. It is designed to be easy to program to, and uses a data model styled after the familiar directory tree structure of file systems. It runs in Java and has bindings for both Java and C.")])])])]),e._v(" "),s("p",[e._v("ZooKeeper：分布式应用程序的分布式协调服务\nZooKeeper 是用于分布式应用程序的分布式，开放源代码协调服务。\n它公开了一组简单的原函数，分布式应用程序可以基于这些原函数来实现用于同步，\n配置维护以及组和命名的更高级别的服务。\n它的设计易于编程，并使用了按照文件系统熟悉的目录树结构样式的数据模型。\n它以 Java 运行，并且具有 Java 和 C 的绑定。")]),e._v(" "),s("p",[e._v("众所周知，协调服务很难做到。它们特别容易出现诸如比赛条件和死锁之类的错误。\nZooKeeper 背后的动机是减轻分布式应用程序从头开始实施协调服务的责任。")]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://zookeeper.apache.org/doc/current/zookeeperStarted.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("ZooKeeper 官方文档"),s("OutboundLink")],1)])]),e._v(" "),s("h2",{attrs:{id:"zookeeper-的安装部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper-的安装部署"}},[e._v("#")]),e._v(" ZooKeeper 的安装部署")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"title"}),s("p",[e._v("安装前需确保已安装 Java 运行环境（JDK 7 及以上）。"),s("br"),e._v("\n以下以 CentOS 8，ZooKeeper 3.6.0 版本为例。")])]),s("h3",{attrs:{id:"下载解压"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载解压"}},[e._v("#")]),e._v(" 下载解压")]),e._v(" "),s("p",[s("a",{attrs:{href:"http://zookeeper.apache.org/releases.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Zookeeper Releases 页面"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("复制对应版本的下载链接，使用以下命令下载解压：")]),e._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 下载到本地")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("wget")]),e._v(" https://downloads.apache.org/zookeeper/zookeeper-3.6.0/apache-zookeeper-3.6.0-bin.tar.gz\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 解压到 /usr/local/")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("tar")]),e._v(" -zxvf apache-zookeeper-3.6.0-bin.tar.gz -C /usr/local/\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 重命名文件夹")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mv")]),e._v(" apache-zookeeper-3.6.0-bin/ zookeeper-3.6.0\n")])])]),s("h3",{attrs:{id:"单机模式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单机模式"}},[e._v("#")]),e._v(" 单机模式")]),e._v(" "),s("ol",[s("li",[s("p",[e._v("修改配置文件")]),e._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /usr/local/zookeeper-3.6.0/conf\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 重命名示例配置文件（包含一些简单配置）")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mv")]),e._v(" zoo_sample.cfg zoo.cfg\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 编辑配置文件")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" zoo.cfg\n")])])]),s("p",[e._v("加入或修改以下配置：")]),e._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# the basic time unit in milliseconds used by ZooKeeper. It is used to do heartbeats and the minimum session timeout will be twice the tickTime.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("tickTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("2000")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 数据目录（自己新建一个） the location to store the in-memory database snapshots and, unless specified otherwise, the transaction log of updates to the database.")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("/var/lib/zookeeper")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# the port to listen for client connections")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("2181")]),e._v("\n")])])])]),e._v(" "),s("li",[s("p",[e._v("启动 ZooKeeper")]),e._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /usr/local/zookeeper-3.6.0/bin\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 启动")]),e._v("\nzkServer.sh start\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 查看状态")]),e._v("\nzkServer.sh status\n")])])])])]),e._v(" "),s("h3",{attrs:{id:"伪集群搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#伪集群搭建"}},[e._v("#")]),e._v(" 伪集群搭建")]),e._v(" "),s("p",[e._v("有时候我们没有足够的服务器搭建集群，就只能在一台机器上搭建伪集群。")]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"title"}),s("p",[e._v("官方建议部署奇数个节点，不然选举会有问题。")])]),s("ol",[s("li",[s("p",[e._v("如上所述下载解压后，新建一个"),s("code",[e._v("/usr/local/zookeeper-cluster")]),e._v("目录，复制 ZooKeeper 到该文件夹下三个不同目录：")]),e._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" zookeeper-cluster\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" -r zookeeper-3.6.0 zookeeper-cluster/zookeeper-1\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" -r zookeeper-3.6.0 zookeeper-cluster/zookeeper-2\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" -r zookeeper-3.6.0 zookeeper-cluster/zookeeper-3\n")])])])]),e._v(" "),s("li",[s("p",[e._v("配置每个 ZooKeeper 的端口、myid 和集群配置")]),e._v(" "),s("ul",[s("li",[e._v("配置文件")])]),e._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# conf/zoo.cfg")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("tickTime")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("2000")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("initLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("10")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("syncLimit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("5")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("dataDir")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("/usr/local/zookeeper-cluster/zookeeper-1/data")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("clientPort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("2181")]),e._v("\n\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("server.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("你的机器IP:2881:3881")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("server.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("你的机器IP:2882:3882")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token attr-name"}},[e._v("server.3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("=")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[e._v("你的机器IP:2883:3883")]),e._v("\n")])])]),s("p",[e._v("三个 ZooKeeper 分别设置不同的端口"),s("code",[e._v("clientPort")]),e._v("为 2181、2182、2183，同时修改对应的"),s("code",[e._v("dataDir")]),e._v("。")]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"title"}),s("p",[e._v("如果是公网 IP，注意云服务器的安全组配置。")])]),s("ul",[s("li",[e._v("设置 myid")])]),e._v(" "),s("p",[e._v("同时在每个 ZooKeeper 的"),s("code",[e._v("dataDir")]),e._v("对应的文件夹下，创建 myid 文件，分别输入 1、2、3 保存，即每个 ZooKeeper 的 ID。")]),e._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /usr/local/zookeeper-cluster/zookeeper-1/data\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 创建文件")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("touch")]),e._v(" myid\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 编辑")]),e._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" myid\n")])])])]),e._v(" "),s("li",[s("p",[e._v("启动集群")]),e._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh start\n/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh start\n/usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh start\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"title"}),s("p",[e._v("路径太长可以自己设置一个环境变量，参考"),s("RouterLink",{attrs:{to:"/views/note/ops/202004031522-linux-environment-variable.html"}},[e._v("Linux 环境变量")])],1)]),s("p",[e._v("查看状态：")]),e._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[e._v("/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status\n")])])]),s("p",[e._v("如果输出提示错误，可查看日志"),s("code",[e._v("logs/zookeeper-root-server-xxx.out")]),e._v("定位问题来解决。")])])])])}),[],!1,null,null,null);t.default=r.exports}}]);